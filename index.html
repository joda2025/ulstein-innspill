<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Innspill til Ulstein kommunes sentrumsplan</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .slider {
      position: relative;
      width: 100%;
      overflow: hidden;
    }
    .slides {
      display: flex;
      transition: transform 0.5s ease;
    }
    .slide {
      min-width: 100%;
      box-sizing: border-box;
    }
    .slide img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div id="root"></div>
  <script type="text/babel">
    function App() {
      const [name, setName] = React.useState('');
      const [letter, setLetter] = React.useState('');
      const [error, setError] = React.useState('');
      const [copySuccess, setCopySuccess] = React.useState('');
      const [currentSlide, setCurrentSlide] = React.useState(0);

      const images = [
        { src: "before_blocking_view.jpg", caption: "Før: Ulsteinvik før potensiell utbygging" },
        { src: "after_blocking_view.jpg", caption: "Etter: Utsikt med høghus" },
        { src: "current_sea_view.jpg", caption: "Dagens sjøutsikt" },
        { src: "proposed_building_site.jpg", caption: "Foreslått byggetomt (SF7/SF15)" },
      ];

      const nextSlide = () => {
        setCurrentSlide((prev) => (prev + 1) % images.length);
      };

      const prevSlide = () => {
        setCurrentSlide((prev) => (prev - 1 + images.length) % images.length);
      };

      const generateLetter = () => {
        const today = new Date().toLocaleDateString('no-NO');
        const letterContent = `Innspill til Ulstein kommunes sentrumsplan
Dato: ${today}

Kjære Ulstein kommune,

Eg, ${name}, er innbyggjar i Ulsteinvik og er sterkt bekymra for den nye sentrumsplanen som tillater høghus på tomtene SF7 og SF15. Desse bygga vil blokkere sjøutsikten i sentrum, ein uvurderleg kvalitet i vårt lokalsamfunn som områdeplanen (PlanID 20210001, § 1) vektlegg. Sjøfronten er hjartet i Ulsteinviks maritime identitet, og vi kan ikkje akseptere at den forsvinn.

Eg foreslår at tomta SF7 blir omgjort til ein stor felles park eller eit åpent område, slik at innbyggjarane kan nyte sjøen. Eg ber kommunen revurdere planen for SF7 og SF15 og prioritere løsninger som bevarer sjøutsikten og tilgangen til sjøfronten. Vennligst bekreft mottak av dette innspillet og hold meg oppdatert på høyringsprosessen.

Med vennleg helsing,
${name}`;
        setLetter(letterContent);
        setError('');
        setCopySuccess('');
      };

      const sendEmail = () => {
        try {
          const subject = encodeURIComponent("Innspill til ny sentrumsplan");
          const body = encodeURIComponent(letter.trim());
          const mailtoLink = `mailto:johannesdahl@gmail.com?subject=${subject}&body=${body}`;
          window.location.href = mailtoLink;
          setTimeout(() => {
            if (document.activeElement.tagName !== 'A') {
              setError('Kunne ikke åpne e-postklienten. Klikk "Kopier brev", lim inn i din e-post (f.eks. Gmail), og send til johannesdahl@gmail.com.');
            }
          }, 1500);
        } catch (e) {
          setError('Feil ved åpning av e-postklient. Klikk "Kopier brev", lim inn i din e-post (f.eks. Gmail), og send til johannesdahl@gmail.com.');
        }
      };

      const copyToClipboard = () => {
        try {
          navigator.clipboard.writeText(letter).then(() => {
            setCopySuccess('Brevet er kopiert! Lim det inn i din e-posttjeneste og send til johannesdahl@gmail.com.');
            setError('');
            setTimeout(() => setCopySuccess(''), 5000);
          }).catch(() => {
            setError('Kunne ikke kopiere. Marker brevet manuelt, kopier, og lim inn i din e-posttjeneste.');
            setCopySuccess('');
          });
        } catch (e) {
          setError('Kunne ikke kopiere. Marker brevet manuelt, kopier, og lim inn i din e-posttjeneste.');
          setCopySuccess('');
        }
      };

      const downloadPDF = () => {
        const element = document.createElement('a');
        const file = new Blob([letter], { type: 'text/plain' });
        element.href = URL.createObjectURL(file);
        element.download = 'innspill_ulstein_kommune.txt';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
      };

      return (
        <div className="max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-lg">
          {/* Hero-seksjon med logo, overskrift og introduksjon */}
          <div className="text-center mb-8">
            <img src="ulstein_kommune_logo.png" alt="Ulstein Kommune Logo" className="h-16 mx-auto mb-4" />
            <h1 className="text-3xl font-bold text-gray-800 mb-4">Bevar sjøutsikten i Ulsteinvik sentrum!</h1>
            <p className="text-gray-600 mb-6">
              Områdeplanen for Ulsteinvik sentrum skal gjere byrommet vårt betre – med eit nytt bytorg ved kulturallmenningen, ein oppgradert hamnepromenade og gode gang- og sykkelvegar (jf. planprogrammet, s. 8 og s. 6). Men vi må stoppe fortettinga som kan "bygge oss inne"! Planen tillater høghus på tomtene <span className="font-semibold">SF7</span> og <span className="font-semibold">SF15</span>, som trugar sjøutsikten (jf. s. 8 om byggehøgder). Vi foreslår at <span className="font-semibold">SF7</span> blir ein stor felles park, slik at innbyggjarane kan nyte sjøfronten. Sjå bileta og send inn ditt innspill no!
            </p>
          </div>

          {/* Slider for bilder */}
          <div className="slider mb-8">
            <div className="slides" style={{ transform: `translateX(-${currentSlide * 100}%)` }}>
              {images.map((image, index) => (
                <div className="slide" key={index}>
                  <img src={image.src} alt={image.caption} />
                  <p className="text-center text-gray-600 text-sm mt-2">{image.caption}</p>
                </div>
              ))}
            </div>
            <button
              onClick={prevSlide}
              className="absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full"
            >
              &lt;
            </button>
            <button
              onClick={nextSlide}
              className="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full"
            >
              &gt;
            </button>
          </div>

          {/* Eksisterende navnefelt og brevfunksjonalitet */}
          <div className="mb-4">
            <label className="block text-gray-700 font-medium mb-2" htmlFor="name">
              Ditt navn
            </label>
            <input
              id="name"
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              className="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Skriv inn ditt fulle navn"
            />
          </div>
          <button
            onClick={generateLetter}
            className="w-full bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition"
            disabled={!name.trim()}
          >
            Generer brev
          </button>
          {letter && (
            <div className="mt-6">
              <h2 className="text-lg font-semibold text-gray-800 mb-2">Ditt brev</h2>
              <pre className="bg-gray-50 p-4 rounded-lg text-sm text-gray-700 whitespace-pre-wrap">
                {letter}
              </pre>
              {error && (
                <p className="mt-2 text-red-600">{error}</p>
              )}
              {copySuccess && (
                <p className="mt-2 text-green-600">{copySuccess}</p>
              )}
              <div className="flex flex-wrap gap-4 mt-4">
                <button
                  onClick={copyToClipboard}
                  className="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition"
                >
                  Kopier brev
                </button>
                <button
                  onClick={sendEmail}
                  className="bg-purple-600 text-white p-2 rounded-lg hover:bg-purple-700 transition"
                >
                  Send brev via e-post
                </button>
                <button
                  onClick={downloadPDF}
                  className="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition"
                >
                  Last ned som tekstfil
                </button>
              </div>
              <p className="mt-4 text-gray-600">
                Klikk "Kopier brev" for å kopiere brevet, lim det inn i din e-posttjeneste (f.eks. Gmail), og send til johannesdahl@gmail.com. Alternativt, prøv "Send brev via e-post" for å bruke din e-postklient, eller last ned som tekstfil.
              </p>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
